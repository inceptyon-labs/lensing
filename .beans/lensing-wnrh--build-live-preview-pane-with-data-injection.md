---
# lensing-wnrh
title: Build live preview pane with data injection
status: completed
type: task
priority: high
created_at: 2026-02-28T15:46:16Z
updated_at: 2026-02-28T23:44:41Z
parent: lensing-rq0o
---

Live preview that renders the widget at actual display size with real data from the connector test fetch.

## Acceptance Criteria

- [x] Preview pane alongside or below GrapesJS editor
- [x] Renders HTML/CSS output with {{placeholders}} replaced by real data
- [x] Updates live as user edits in GrapesJS
- [x] Size toggle to preview small/medium/large widget dimensions
- [x] Dark background matching actual display environment
- [x] Shows "No data" state when connector hasn't been tested yet

---

**Size:** M
**Area:** frontend

## Completed

**Files changed:**
- apps/display/src/lib/BuilderPreview.svelte (109 lines, new) — preview pane with iframe rendering, data injection, size toggle, no-data state
- apps/display/src/__tests__/builder-preview.test.ts (185 lines, new) — 15 tests covering all acceptance criteria
- apps/display/src/lib/GrapesJSEditor.svelte (modified) — added onChange prop for live preview updates
- apps/display/src/__tests__/grapesjs-editor.test.ts (82 lines, new) — 5 tests for onChange callback using mocked grapesjs

**Key decisions:**
- iframe srcdoc for CSS isolation (prevents preview styles bleeding into admin UI)
- Avoided `<style>` block in Svelte components due to vite@6 preprocessor bug in test env; use inline styles instead
- Avoided `<style>` literal in template strings (Svelte preprocessor regex matches it as a real style tag); used string concatenation in buildSrcdoc()
- {{placeholder}} syntax resolves dot-notation paths (e.g. {{source.name}}) — consistent with JSONPath-style mappings from BuilderStep3
- onChange subscribes only when prop is provided (no wasted event listeners)

**Notes for next task:**
- BuilderPreview: props are html, css, sampleData (null/undefined = no-data state), size (small/medium/large)
- GrapesJSEditor: new onChange(html, css) prop fires on component:update and style:property:update events
- Parent integration: wire GrapesJSEditor.onChange → state → pass to BuilderPreview for live updates
- IMPORTANT: Don't add `<style>` blocks to Svelte components in apps/display — use inline styles instead (vite@6 CSS preprocessing fails in test env)

---
*Auto-generated by PASIV*
