---
# lensing-r18h
title: Build plugin ZIP packaging for publish
status: completed
type: task
priority: high
created_at: 2026-02-28T15:47:19Z
updated_at: 2026-03-01T00:55:29Z
parent: lensing-lmnp
---

Package a builder-created plugin into a ZIP file suitable for marketplace distribution.

## Acceptance Criteria

- [x] Creates ZIP containing plugin.json, template.html, template.css, connector.json
- [x] Auto-generates thumbnail.png from widget preview (screenshot or canvas export)
- [x] Validates total ZIP size < 10MB
- [x] Validates no disallowed file types (.exe, .dll, etc.)
- [x] ZIP structure matches marketplace expectations (flat, no wrapper folder)

---

**Size:** M
**Area:** backend

## Completed

**Files changed:**

- packages/core/src/plugin-package.ts (new, 91 lines) — packagePlugin() function with ZIP creation, manifest derivation, size validation
- packages/core/src/**tests**/plugin-package.test.ts (new, 205 lines) — 19 tests covering all acceptance criteria
- packages/core/src/index.ts (modified) — export packagePlugin, PackageInput, PackageResult, ConnectorInput

**Key decisions:**

- Validates uncompressed content size (not compressed ZIP size) against 10MB limit — more meaningful for runtime disk impact
- Disallowed file type validation is implicitly handled by construction (only known safe filenames are added)
- ConnectorInput is a new type (not reusing ConnectorTestConfig) because packaging needs refreshInterval field
- Thumbnail is accepted as an optional Buffer — the UI layer is responsible for generating it from canvas/screenshot

**Notes for next task:**

- Use `packagePlugin(input)` to create ZIP buffers for marketplace publishing
- The returned `PackageResult.buffer` is ready for GitHub API upload or `installPluginFromZip()`
- Connector headers are included verbatim — the publish flow should consider stripping sensitive headers before packaging
- `allowed_domains` is derived from the connector URL hostname (port stripped)
- `max_refresh_ms` is derived from `refreshInterval * 1000` (omitted when refreshInterval not provided)

---

_Auto-generated by PASIV_
