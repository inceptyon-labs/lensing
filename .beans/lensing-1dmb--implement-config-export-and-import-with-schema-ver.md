---
# lensing-1dmb
title: Implement config export and import with schema versioning
status: in-progress
type: task
priority: normal
tags:
    - pasiv
    - size:M
    - area:backend
created_at: 2026-02-16T21:25:40Z
updated_at: 2026-02-22T11:52:21Z
parent: lensing-kd62
---

Config export/import with schema versioning and automatic migrations.

## Acceptance Criteria

- [x] Export: dump full config (layout, plugin settings, themes, scene schedules) as single JSON
- [x] Import: restore config from JSON file, apply on new Pi
- [x] Schema version field in exported JSON
- [x] Automatic migrations: import from older schema versions to current
- [x] CLI: `lensing config export`, `lensing config import <file>`, `lensing config reset`

---

**Size:** M

## Completed

**Files changed:**
packages/types/src/config-transfer.ts (types, constants)
packages/types/src/__tests__/config-transfer.test.ts (6 tests)
packages/types/src/index.ts (exports)
packages/core/src/config-transfer.ts (factory module)
packages/core/src/__tests__/config-transfer.test.ts (24 tests)
packages/core/src/__tests__/config-transfer-integration.test.ts (3 tests)
packages/core/src/index.ts (exports)
package.json (ESLint downgrade)
pnpm-lock.yaml (ESLint downgrade)

**Key decisions:**
CURRENT_CONFIG_VERSION = 1 as separate track from SQLite schema version (user_version)
Object.create(null) for intermediate maps to prevent __proto__ key data loss
Version validation requires positive integer >= 1 (rejects NaN, 0, -1, fractional)
Import is merge semantics (upserts keys, does not delete absent ones)
Import is non-atomic (no transaction support in DatabaseInstance)
ESLint downgraded from 10.0.0 â†’ 9.39.3 due to typescript-eslint incompatibility

**Notes for next task:**
createConfigTransfer({database}) returns {exportConfig, importConfig, resetConfig}
ConfigExportV1 shape: {version, exportedAt, schemaVersion, settings, layouts, pluginState}
CURRENT_CONFIG_VERSION exported from @lensing/types and re-exported from @lensing/core
Import accepts unknown, validates version field, then applies settings/layouts/pluginState
Reset iterates all keys and deletes one-by-one (no batch delete API)
33 total tests (6 types + 24 unit + 3 integration)

---
*Auto-generated by PASIV*
