---
# lensing-2c24
title: Create connector test proxy endpoint
status: completed
type: task
priority: high
created_at: 2026-02-28T15:45:40Z
updated_at: 2026-02-28T23:27:08Z
parent: lensing-mb8p
---

REST endpoint that proxies a test fetch through the connector engine and returns sample data for the builder UI.

## Acceptance Criteria

- [x] POST /builder/test-connector accepts ConnectorConfig body
- [x] Executes a single connector fetch (JSON API or RSS)
- [x] Returns sample response data and extracted field mapping preview
- [x] Applies SSRF blocklist validation before fetching
- [x] Returns clear error on failure (HTTP status, timeout, parse error)
- [x] 10s timeout to prevent hanging

---

**Size:** S
**Area:** backend

## Completed

**Files changed:**
- packages/core/src/connector-proxy.ts (186 lines new) - Core proxy with SSRF protection, JSON/RSS parsing, field extraction
- packages/core/src/__tests__/connector-proxy.test.ts (296 lines new) - 21 unit tests covering validation, SSRF, JSON/RSS, errors, timeouts
- packages/core/src/__tests__/rest-server-builder.test.ts (201 lines new) - 6 integration tests for REST endpoint
- packages/core/src/rest-server.ts (+25 lines) - Added testConnector handler type and POST /api/admin/builder/test-connector route

**Key decisions:**
- Injectable fetchFn pattern for testability (consistent with existing codebase)
- AbortController timeout with 10s default (prevents hanging, matches behavior requirement)
- Recursive field path extraction with maxDepth guard (handles nested JSON, arrays)
- Simple regex-based RSS parser (no external dependency)
- SSRF blocklist applied before fetch (allowPrivate option not exposed via HTTP)
- Error messages don't leak internals (500 handler only uses err.message)

**Notes for next task:**
- Handler registered at POST /api/admin/builder/test-connector
- Returns ConnectorTestResult with success/sample/fields or error
- Supports json_api and rss_feed types
- All 871 core tests passing (49 test files)
- Build, TypeCheck, no dedicated linter config

---
*Auto-generated by PASIV*
